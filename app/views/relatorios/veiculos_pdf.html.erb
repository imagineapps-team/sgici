<%= render partial: 'relatorios/shared/pdf_header', locals: {
  titulo: @titulo,
  subtitulo: 'Relatorio de Veiculos',
  data_geracao: @data_geracao
} %>

<% if @dados.present? %>
  <%
    totais = {
      quantidade: @dados.sum { |d| d[:quantidade_total].to_s.gsub('.', '').gsub(',', '.').to_f },
      bonus: @dados.sum { |d| d[:bonus_total].to_s.gsub('.', '').gsub(',', '.').to_f }
    }
  %>

  <%= render partial: 'relatorios/shared/pdf_summary', locals: {
    titulo: 'Resumo Geral',
    items: [
      { label: 'Total de Registros', value: number_with_delimiter(@dados.length) },
      { label: 'Quantidade Total (KG)', value: number_with_precision(totais[:quantidade], precision: 2, delimiter: '.', separator: ',') },
      { label: 'Valor Total (R$)', value: number_with_precision(totais[:bonus], precision: 2, delimiter: '.', separator: ',') }
    ]
  } %>

  <% if @modelo == 'RG' %>
    <%# Modelo RG - Geral %>
    <table>
      <thead>
        <tr>
          <th>Veiculo</th>
          <th>Placa</th>
          <th>Tipo Residuo</th>
          <th>Local</th>
          <th class="text-right">Valor (R$)</th>
          <th class="text-right">Qtd (Kg)</th>
          <th>Data</th>
        </tr>
      </thead>
      <tbody>
        <% @dados.each do |item| %>
          <tr>
            <td><%= item[:veiculo_tipo] %></td>
            <td><%= item[:placa] %></td>
            <td><%= item[:recurso_tipo] %></td>
            <td><%= item[:local_acao] %></td>
            <td class="text-right"><%= item[:bonus_total] %></td>
            <td class="text-right"><%= item[:quantidade_total] %></td>
            <td><%= item[:data_cadastro] %></td>
          </tr>
        <% end %>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="4"><strong>TOTAL</strong></td>
          <td class="text-right"><%= number_with_precision(totais[:bonus], precision: 2, delimiter: '.', separator: ',') %></td>
          <td class="text-right"><%= number_with_precision(totais[:quantidade], precision: 2, delimiter: '.', separator: ',') %></td>
          <td></td>
        </tr>
      </tfoot>
    </table>

  <% elsif @modelo == 'RR' %>
    <%# Modelo RR - Por Tipo de Residuo %>
    <table>
      <thead>
        <tr>
          <th>Veiculo</th>
          <th>Placa</th>
          <th>Tipo Residuo</th>
          <th class="text-right">Valor (R$)</th>
          <th class="text-right">Qtd (Kg)</th>
          <th>Data</th>
        </tr>
      </thead>
      <tbody>
        <% @dados.each do |item| %>
          <tr>
            <td><%= item[:veiculo_tipo] %></td>
            <td><%= item[:placa] %></td>
            <td><%= item[:recurso_tipo] %></td>
            <td class="text-right"><%= item[:bonus_total] %></td>
            <td class="text-right"><%= item[:quantidade_total] %></td>
            <td><%= item[:data_cadastro] %></td>
          </tr>
        <% end %>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="3"><strong>TOTAL</strong></td>
          <td class="text-right"><%= number_with_precision(totais[:bonus], precision: 2, delimiter: '.', separator: ',') %></td>
          <td class="text-right"><%= number_with_precision(totais[:quantidade], precision: 2, delimiter: '.', separator: ',') %></td>
          <td></td>
        </tr>
      </tfoot>
    </table>

  <% elsif @modelo == 'RV' %>
    <%# Modelo RV - Por Veiculo %>
    <table>
      <thead>
        <tr>
          <th>Veiculo</th>
          <th>Placa</th>
          <th class="text-right">Valor (R$)</th>
          <th class="text-right">Qtd (Kg)</th>
          <th>Data</th>
        </tr>
      </thead>
      <tbody>
        <% @dados.each do |item| %>
          <tr>
            <td><%= item[:veiculo_tipo] %></td>
            <td><%= item[:placa] %></td>
            <td class="text-right"><%= item[:bonus_total] %></td>
            <td class="text-right"><%= item[:quantidade_total] %></td>
            <td><%= item[:data_cadastro] %></td>
          </tr>
        <% end %>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="2"><strong>TOTAL</strong></td>
          <td class="text-right"><%= number_with_precision(totais[:bonus], precision: 2, delimiter: '.', separator: ',') %></td>
          <td class="text-right"><%= number_with_precision(totais[:quantidade], precision: 2, delimiter: '.', separator: ',') %></td>
          <td></td>
        </tr>
      </tfoot>
    </table>

  <% else %>
    <%# Modelo RL - Por Local %>
    <table>
      <thead>
        <tr>
          <th>Veiculo</th>
          <th>Placa</th>
          <th>Local</th>
          <th class="text-right">Valor (R$)</th>
          <th class="text-right">Qtd (Kg)</th>
          <th>Data</th>
        </tr>
      </thead>
      <tbody>
        <% @dados.each do |item| %>
          <tr>
            <td><%= item[:veiculo_tipo] %></td>
            <td><%= item[:placa] %></td>
            <td><%= item[:local_acao] %></td>
            <td class="text-right"><%= item[:bonus_total] %></td>
            <td class="text-right"><%= item[:quantidade_total] %></td>
            <td><%= item[:data_cadastro] %></td>
          </tr>
        <% end %>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="3"><strong>TOTAL</strong></td>
          <td class="text-right"><%= number_with_precision(totais[:bonus], precision: 2, delimiter: '.', separator: ',') %></td>
          <td class="text-right"><%= number_with_precision(totais[:quantidade], precision: 2, delimiter: '.', separator: ',') %></td>
          <td></td>
        </tr>
      </tfoot>
    </table>
  <% end %>

  <%= render partial: 'relatorios/shared/pdf_footer', locals: {
    data_geracao: @data_geracao,
    total_registros: @dados.length
  } %>

<% else %>
  <%= render partial: 'relatorios/shared/pdf_no_data' %>

  <%= render partial: 'relatorios/shared/pdf_footer', locals: {
    data_geracao: @data_geracao
  } %>
<% end %>
